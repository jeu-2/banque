<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banque J.E.U. - Interface Client</title>
    <link href="/banque/css/style.css" rel="stylesheet"/>
    <script src="/banque/js/main.js"></script>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>‚ö° BANQUE J.E.U. ‚ö°</h1>
        <p>JARDIN D'√âCHANGE UNIVERSEL - MONNAIE COMMUNAUTAIRE</p>
    </div>

    <!-- Dashboard Grid -->
    <div class="dashboard">
        <!-- Tableau de Bord Membre -->
        <div class="module-card fade-in-up">
            <div class="module-header">
                <span class="module-icon">üë§</span>
                <h2 class="module-title">Tableau de Bord Membre</h2>
            </div>
            <div class="balance-display">
                <div class="user-name">Jean-Fran√ßois Tremblay</div>
                <div class="user-status">Membre Fondateur</div>
                <div class="balance-amount">2,450</div>
                <div class="balance-label">Points J.E.U. disponibles</div>
                <div class="member-code">Membre : JEU0000001</div>
            </div>
            <div class="stats-grid">
                <div class="stat-box">
                    <span class="stat-number">47</span>
                    <span class="stat-label">√âchanges totaux</span>
                </div>
                <div class="stat-box">
                    <span class="stat-number">12</span>
                    <span class="stat-label">Partenaires actifs</span>
                </div>
                <div class="stat-box">
                    <span class="stat-number">98%</span>
                    <span class="stat-label">Score fiabilit√©</span>
                </div>
                <div class="stat-box">
                    <span class="stat-number">5‚≠ê</span>
                    <span class="stat-label">√âvaluation</span>
                </div>
            </div>
        </div>

        <!-- Nouvelle Offre -->
        <div class="module-card fade-in-up">
            <div class="module-header">
                <span class="module-icon">üì¢</span>
                <h2 class="module-title">Nouvelle Offre</h2>
            </div>
            <form id="offerForm">
                <div class="form-group">
                    <label class="form-label">Titre de l'Offre</label>
                    <input type="text" class="form-input" placeholder="Ex: Cours de cuisine italienne" id="offreTitre" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Type de l'Offre</label>
                    <select class="form-select" id="offreType" required>
                        <option value="">S√©lectionner un type...</option>
                        <option value="speciale">Sp√©ciale</option>
                        <option value="saisonniere">Saisonni√®re</option>
                        <option value="ponctuelle">Ponctuelle</option>
                        <option value="continue">Continue</option>
                        <option value="liquidation">Liquidation</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Cat√©gorie</label>
                    <select class="form-select" id="offreCategorie" required>
                        <option value="">S√©lectionner une cat√©gorie...</option>
                        <option value="hebergement">H√©bergement</option>
                        <option value="evenement">√âv√©nement</option>
                        <option value="produit">Produit</option>
                        <option value="service">Service</option>
                        <option value="don">Don</option>
                        <option value="bonus">Bonus</option>
                        <option value="correctif">Correctif</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Montant (Points J.E.U.)</label>
                    <input type="number" class="form-input" placeholder="Ex: 80" id="offrePrixPoints" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" placeholder="D√©crivez votre offre en d√©tail..." id="offreDescription" required></textarea>
                </div>
                <button type="submit" class="btn-primary">Publier l'Offre</button>
            </form>
        </div>

        <!-- Nouvelle Transaction -->
        <div class="module-card fade-in-up">
            <div class="module-header">
                <span class="module-icon">üíé</span>
                <h2 class="module-title">Nouvelle Transaction</h2>
            </div>
            <form id="transactionForm">
                <div class="form-group">
                    <label class="form-label">Type d'√©change</label>
                    <select class="form-select" id="transactionType" required>
                        <option value="">S√©lectionner un type...</option>
                        <option value="speciale">Sp√©ciale</option>
                        <option value="saisonniere">Saisonni√®re</option>
                        <option value="ponctuelle">Ponctuelle</option>
                        <option value="continue">Continue</option>
                        <option value="liquidation">Liquidation</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">R√©f√©rence de l'Offre</label>
                    <input type="text" class="form-input" placeholder="Ex: OFF-2025-rec0ptPxgXb1KsTfX" id="transactionReference" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Code du partenaire</label>
                    <input type="text" class="form-input" placeholder="JEU0000001" id="transactionPartner" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Montant (Points J.E.U.)</label>
                    <input type="number" class="form-input" placeholder="Ex: 50" id="transactionAmount" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description d√©taill√©e</label>
                    <textarea class="form-textarea" placeholder="D√©crivez pr√©cis√©ment l'√©change..." id="transactionDescription" required></textarea>
                </div>
                <button type="submit" class="btn-primary">Enregistrer Transaction</button>
            </form>
        </div>

        <!-- Place du March√© -->
        <div class="module-card fade-in-up">
            <div class="module-header">
                <span class="module-icon">üèÜ</span>
                <h2 class="module-title">Place du March√©</h2>
            </div>
            
            <!-- Section de Recherche -->
            <div class="search-section">
                <input type="text" class="search-input" placeholder="üîç Rechercher une offre, un service, un produit..." id="searchInput">
                <div class="search-filters">
                    <button class="filter-btn active" data-category="services">Services</button>
                    <button class="filter-btn" data-category="produits">Produits</button>
                    <button class="filter-btn" data-category="evenements">√âv√©nements</button>
                </div>
            </div>

            <!-- Offres affich√©es -->
            <div id="offersContainer">
                <div class="marketplace-item" data-category="services">
                    <div class="marketplace-header">
                        <div class="marketplace-title">Cours de yoga priv√©</div>
                        <div class="marketplace-price">80 pts</div>
                    </div>
                    <div class="marketplace-provider">Par Sylvie Martineau</div>
                    <div class="marketplace-description">Disponible ce weekend</div>
                </div>
                <div class="marketplace-item" data-category="services">
                    <div class="marketplace-header">
                        <div class="marketplace-title">R√©paration v√©lo expert</div>
                        <div class="marketplace-price">60 pts</div>
                    </div>
                    <div class="marketplace-provider">Par Pierre Gagnon - Service garantie</div>
                    <div class="marketplace-description">R√©paration compl√®te avec garantie 6 mois</div>
                </div>
            </div>
        </div>

        <!-- Historique des Transactions -->
        <div class="module-card fade-in-up">
            <div class="module-header">
                <span class="module-icon">üìä</span>
                <h2 class="module-title">Historique des Transactions</h2>
            </div>
            <div class="transaction-item">
                <div class="transaction-info">
                    <h4>Coiffure avec Marie Lavall√©e</h4>
                    <div class="transaction-date">21 mai 2025 - 14:30</div>
                </div>
                <div class="transaction-amount negative">-150 pts</div>
            </div>
            <div class="transaction-item">
                <div class="transaction-info">
                    <h4>L√©gumes bio du jardin</h4>
                    <div class="transaction-date">20 mai 2025 - 09:15</div>
                </div>
                <div class="transaction-amount positive">+75 pts</div>
            </div>
            <div class="transaction-item">
                <div class="transaction-info">
                    <h4>Garde d'enfants (3h)</h4>
                    <div class="transaction-date">19 mai 2025 - 18:00</div>
                </div>
                <div class="transaction-amount positive">+200 pts</div>
            </div>
            <div class="transaction-item">
                <div class="transaction-info">
                    <h4>Massage th√©rapeutique</h4>
                    <div class="transaction-date">18 mai 2025 - 16:45</div>
                </div>
                <div class="transaction-amount negative">-125 pts</div>
            </div>
        </div>

        <!-- Messagerie Communautaire -->
        <div class="module-card fade-in-up">
            <div class="module-header">
                <span class="module-icon">üí¨</span>
                <h2 class="module-title">Messagerie Communautaire</h2>
            </div>
            <div class="message-item">
                <div class="message-header">
                    <div class="message-sender">Pierre L.</div>
                    <div class="message-time">Il y a 2h</div>
                </div>
                <div class="message-content">Salut ! J'ai des l√©gumes frais √† √©changer contre des services de jardinage.</div>
            </div>
            <div class="message-item">
                <div class="message-header">
                    <div class="message-sender">Sylvie M.</div>
                    <div class="message-time">Hier</div>
                </div>
                <div class="message-content">Merci pour le massage ! Transaction parfaite comme toujours üòä</div>
            </div>
            <div class="message-compose">
                <textarea class="form-textarea" placeholder="√âcrire un message √† la communaut√©..." rows="3"></textarea>
                <button class="btn-primary" style="margin-top: 1rem;">Envoyer Message</button>
            </div>
        </div>
    </div>
    <div style="height: 25px;"></div>

    <!-- Pied de page -->
    <footer class="custom-footer" style="background: linear-gradient(135deg, rgba(0,0,0,0.9), rgba(20,20,40,0.95)); border-radius: 20px; margin-top: 3rem; border: 2px solid rgba(255,215,0,0.3); backdrop-filter: blur(20px); padding: 2rem; text-align: center;">
        <div class="footer-content">
            <div class="footer-logo" style="font-size: 1.5rem; font-weight: bold; color: #ffd700;">üåü BANQUE J.E.U.</div>
            <div class="footer-links" style="margin: 1rem 0;">
                <a href="#accueil" style="margin: 0 0.5rem; color: #e8e8e8;">Accueil</a>
                <a href="#fonctionnement" style="margin: 0 0.5rem; color: #e8e8e8;">Comment √ßa marche</a>
                <a href="#avantages" style="margin: 0 0.5rem; color: #e8e8e8;">Avantages</a>
                <a href="#contact" style="margin: 0 0.5rem; color: #e8e8e8;">Contact</a>
                <a href="#" style="margin: 0 0.5rem; color: #e8e8e8;">Conditions</a>
                <a href="#" style="margin: 0 0.5rem; color: #e8e8e8;">Confidentialit√©</a>
            </div>
            <div class="footer-bottom" style="color: #c9c9c9; font-size: 0.9rem;">
                <p>¬© 2025 Banque J.E.U. - Jardin d'√âchange Universel. Tous droits r√©serv√©s.</p>
                <p>Une initiative du Consortium BICFIL-MULTI-PAAS-POEZIES sous l'autorit√© de L√©na May√´l</p>
            </div>
        </div>
    </footer>

    <script>
        // Animation on scroll
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver(function(entries) {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('fade-in-up');
                }
            });
        }, observerOptions);

        document.querySelectorAll('.module-card').forEach(el => {
            observer.observe(el);
        });

        // Fonction g√©n√©rique pour g√©rer les soumissions de formulaires
        function handleFormSubmission(e, successMessage) {
            const button = e.target.querySelector('button[type="submit"]');
            const originalText = button.textContent;
            button.textContent = 'Traitement en cours...';
            button.style.background = 'linear-gradient(45deg, #ffed4a, #ffd700)';
            button.disabled = true;
            
            setTimeout(() => {
                button.textContent = '‚úÖ ' + successMessage;
                setTimeout(() => {
                    button.textContent = originalText;
                    button.disabled = false;
                    button.style.background = '';
                }, 3000);
            }, 1500);
        }

        // Attendre que le DOM soit charg√©
        document.addEventListener('DOMContentLoaded', function() {
            // Gestion du formulaire d'offre
            const offerForm = document.getElementById('offerForm');
            if (offerForm) {
                offerForm.addEventListener('submit', async function(e) {
                    e.preventDefault();

                    const titre = document.getElementById("offreTitre").value.trim();
                    const typeOffre = document.getElementById("offreType").value.trim();
                    const categorie = document.getElementById("offreCategorie").value.trim();
                    const prixPoints = parseInt(document.getElementById("offrePrixPoints").value.trim());
                    const description = document.getElementById("offreDescription").value.trim();

                    // V√©rification des donn√©es
                    if (!titre || !typeOffre || !categorie || !prixPoints || !description) {
                        alert("Veuillez remplir tous les champs obligatoires.");
                        return;
                    }

                    const membreProposant = localStorage.getItem("recordId") || "JEU0000001";
                    const dateCreation = new Date().toISOString().split("T")[0];

                    const data = {
                        titre,
                        membreProposant,
                        typeOffre,
                        categorie,
                        description,
                        prixPoints,
                        dureeQuantite: "",
                        avantages: "",
                        dateCreation,
                        dateLimite: "",
                        lieu: "",
                        images: [],
                        commentaires: ""
                    };

                    const button = e.target.querySelector("button[type='submit']");
                    const originalText = button.textContent;

                    button.textContent = "Publication...";
                    button.disabled = true;

                    try {
                        const response = await fetch("https://banque-api-jeu.onrender.com/api/offres", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(data)
                        });

                        const result = await response.json();

                        if (response.ok) {
                            button.textContent = "‚úÖ Offre publi√©e !";
                            e.target.reset();
                            console.log("Offre cr√©√©e avec succ√®s:", result);
                            if (typeof chargerOffres === "function") chargerOffres();
                        } else {
                            console.error("Erreur API:", result);
                            alert("Erreur lors de la publication : " + (result.message || "Erreur inconnue"));
                            button.textContent = "‚ùå √âchec publication";
                        }

                    } catch (err) {
                        console.error("Erreur r√©seau :", err);
                        alert("Erreur de connexion : " + err.message);
                        button.textContent = "‚ùå Erreur r√©seau";
                    }

                    setTimeout(() => {
                        button.textContent = originalText;
                        button.disabled = false;
                    }, 3000);
                });
            }

            // Gestion du formulaire de transaction
            const transactionForm = document.getElementById('transactionForm');
            if (transactionForm) {
                transactionForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const type = document.getElementById("transactionType").value.trim();
                    const reference = document.getElementById("transactionReference").value.trim();
                    const partner = document.getElementById("transactionPartner").value.trim();
                    const amount = document.getElementById("transactionAmount").value.trim();
                    const description = document.getElementById("transactionDescription").value.trim();

                    if (!type || !reference || !partner || !amount || !description) {
                        alert("Veuillez remplir tous les champs obligatoires.");
                        return;
                    }

                    console.log("Transaction soumise:", { type, reference, partner, amount, description });
                    handleFormSubmission(e, 'Transaction Enregistr√©e !');
                    
                    // Reset du formulaire apr√®s succ√®s
                    setTimeout(() => {
                        e.target.reset();
                    }, 2000);
                });
            }

            // Chargement des donn√©es utilisateur
            const nom = localStorage.getItem("nomMembre");
            const code = localStorage.getItem("codeMembre");

            if (nom && code) {
                // Mise √† jour des √©l√©ments du tableau de bord
                const nameEl = document.querySelector(".user-name");
                const codeEl = document.querySelector(".member-code");
                if (nameEl) nameEl.textContent = nom;
                if (codeEl) codeEl.textContent = "Membre : " + code;

                // Cr√©ation de la barre utilisateur avec bouton de d√©connexion
                const userBar = document.createElement("div");
                userBar.style.cssText = `
                    position: fixed;
                    top: 0;
                    right: 0;
                    padding: 0.5rem 1rem;
                    background: rgba(0, 0, 0, 0.9);
                    color: #ffd700;
                    z-index: 9999;
                    border-bottom-left-radius: 10px;
                    backdrop-filter: blur(10px);
                    border: 1px solid rgba(255, 215, 0, 0.3);
                `;
                
                userBar.innerHTML = `
                    <span style="margin-right: 1rem;">üë§ <strong>${nom} (${code})</strong></span>
                    <button id="logoutBtn" style="
                        padding: 0.25rem 0.75rem;
                        background: linear-gradient(45deg, #ff6b6b, #ee5a5a);
                        color: white;
                        border: none;
                        border-radius: 5px;
                        cursor: pointer;
                        font-size: 0.9rem;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        D√©connexion
                    </button>
                `;
                
                document.body.appendChild(userBar);

                // Gestion de la d√©connexion
                document.getElementById("logoutBtn").addEventListener("click", (e) => {
                    e.preventDefault();
                    if (confirm("√ätes-vous s√ªr de vouloir vous d√©connecter ?")) {
                        localStorage.clear();
                        window.location.href = "index.html";
                    }
                });
            } else {
                // Redirection si pas de donn√©es utilisateur
                console.warn("Aucune donn√©e utilisateur trouv√©e, redirection vers la page de connexion");
                // window.location.href = "index.html";
            }
        });
    </script>
</body>
</html>
