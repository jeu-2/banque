
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Banque J.E.U. – Connexion & Inscription</title>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; padding: 2rem; }
    .container { max-width: 500px; margin: auto; background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    h2 { text-align: center; color: #222; }
    .form-group { margin-bottom: 1rem; }
    label { display: block; margin-bottom: 0.3rem; color: #333; }
    input { width: 100%; padding: 0.6rem; font-size: 1rem; }
    button { width: 100%; background: #ffd700; border: none; padding: 0.8rem; font-size: 1rem; cursor: pointer; }
    .tabs { text-align: center; margin-bottom: 1.5rem; }
    .tabs button { margin: 0 0.5rem; padding: 0.5rem 1rem; font-size: 1rem; cursor: pointer; }
    .hidden { display: none; }
    .message { text-align: center; margin-top: 1rem; font-weight: bold; }
  </style>
</head>
<body>

  <div class="container">
    <h2>Banque J.E.U.</h2>

    <div class="tabs">
      <button onclick="switchForm('login')">Se connecter</button>
      <button onclick="switchForm('signup')">S'inscrire</button>
    </div>

    <!-- Connexion -->
    <form id="loginForm">
      <div id="loginFormFields">
        <div class="form-group">
          <label>Email ou Code Membre</label>
          <input type="text" id="loginEmail" required placeholder="JEU000123 ou email">
        </div>
        <div class="form-group">
          <label>Mot de passe</label>
          <input type="password" id="loginPassword" required placeholder="Mot de passe">
        </div>
        <button type="submit">Connexion</button>
        <div class="message" id="loginMessage"></div>
      </div>
    </form>

    <!-- Inscription -->
    <form id="signupForm" class="hidden">
      <div class="form-group">
        <label>Nom complet</label>
        <input type="text" placeholder="Jean Dupont" required>
      </div>
      <div class="form-group">
        <label>Email</label>
        <input type="email" placeholder="email@example.com" required>
      </div>
      <div class="form-group">
        <label>Mot de passe</label>
        <input type="password" placeholder="Créer un mot de passe" required>
      </div>
      <button type="submit">Créer un compte</button>
    </form>
  </div>

  <script>
    function switchForm(mode) {
      document.getElementById("loginForm").classList.toggle("hidden", mode !== "login");
      document.getElementById("signupForm").classList.toggle("hidden", mode !== "signup");
    }

    document.getElementById("loginForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const email = document.getElementById("loginEmail").value.trim();
      const password = document.getElementById("loginPassword").value.trim();
      const message = document.getElementById("loginMessage");
      message.textContent = "";

      localStorage.clear();

      try {
        const res = await fetch("https://banque-api-jeu.onrender.com/api/membres");
        const membres = await res.json();

        const membre = membres.find(m =>
          m.email?.toLowerCase() === email.toLowerCase() ||
          m.code?.toUpperCase() === email.toUpperCase()
        );

        if (!membre) {
          message.textContent = "❌ Membre introuvable.";
          return;
        }

        if (membre.motdepasse !== password) {
          message.textContent = "❌ Mot de passe incorrect.";
          return;
        }

        localStorage.setItem("recordId", membre.id);
        localStorage.setItem("nomMembre", membre.nom);
        localStorage.setItem("codeMembre", membre.code);
        localStorage.setItem("emailMembre", membre.email);

        message.textContent = "✅ Connexion réussie. Redirection...";
        setTimeout(() => window.location.href = "client/client.html", 1000);

      } catch (err) {
        message.textContent = "❌ Erreur de connexion au serveur.";
      }
    });
  </script>
</body>
</html>
